# SQL学习笔记

## 第九题:获取非管理者的员工编号  
### 题目理解  
查找所有非经理部门的员工编号。即在employees表中但不在dept_manager表中的员工。

### 核心sql

***
```  sql 
select
    e.emp_no
from
    employees e
where
    e.emp_no not in (
        select distinct
            d.emp_no
        from
            dept_manager d
    );
```
### 关键知识点
1. 子查询
    * 在where条件中嵌套select查询
    * 先执行子查询，结果用于主查询过滤
2. not in
    * 排除指定列表中的值
    * 注意：如果子查询返回null, not in可能会有问题
    * 代替方案：not exists
3. distinct去重
    * 确保子查询结果唯一
    * 虽然dept_manager表有唯一索引，但可能返回多个结果
### 优化方案
```` sql
select 
    e.emp_no
from
    employees e
    left join dept_manager m on e.emp_no = m.emp_no
where
    m.emp_no is null;
````


## 第十题:查找同一部门中非经理员工

### 题目理解  
对于每个部门经理，找出他所在部门的其他员工  
### 核心sql
 ***
``` sql
select
    e.emp_no,
    m.emp_no
from
    dept_manager m
    left join dept_emp e on m.dept_no = e.dept_no
where
    m.emp_no != e.emp_no
order by
    m.dept_no;
```    
### 关键知识点
1. left join
   * 以经理表为主表
   * 确保所有经理都显示，即使部门没有其他员工
   * 此时e.emp_no可能为null
2. 不平等条件筛选
   * m.emp_no != e.emp_no
   * 排除经理自己
3. order by
   * 按部门编号排序,便于查看